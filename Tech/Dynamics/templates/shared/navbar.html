{% load static %}

<!-- # Barra de navegación -->
<style>
  :root {
      --primary: #2196f3;
      --light: #f5f5f5;
      --gray: #757575;
    }
    
    
    .unique-chat-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 990;
    }
    
    .unique-chat-container {
      position: relative;
      max-width: 1000px;
      width:`100% ;
      margin: 0;
      background: white;
      z-index: 991;
    }
    
    .unique-chat-list {
      border-right: 1px solid #eee;
      overflow-y: auto;
    }
    
    .unique-chat-preview {
      padding: 1rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.2s;
      color:black;
    }
    
    .unique-chat-preview:hover {
      background: var(--light);
    }
    
    .unique-chat-preview.active {
      background: #e3f2fd;
    }
    
    .unique-chat-preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .unique-chat-preview-name {
      font-weight: 600;
    }
    
    .unique-chat-preview-time {
      font-size: 0.8rem;
      color: var(--gray);
    }
    
    .unique-chat-preview-last {
      color: var(--gray);
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .unique-chat-main {
      display: flex;
      flex-direction: column;
    }
    
    .unique-chat-header {
      padding: 1rem;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .unique-chat-header-info h2 {
      font-size: 1.1rem;
      margin-bottom: 0.2rem;
    }
    
    .unique-chat-header-info .unique-status {
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    .unique-chat-header-actions {
      display: flex;
      align-items: center;
    }
    
    .unique-chat-header-actions button {
      padding: 0.5rem;
      margin-left: 0.5rem;
      border: none;
      background: none;
      cursor: pointer;
      color: var(--gray);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      transition: background 0.2s;
      border: 2px solid transparent; /* Sin borde visible */
    }
    
    .unique-chat-header-actions button:hover {
      background: var(--light);
    }
    
    .unique-chat-header-actions button:last-child {
      margin-left: 0.5rem;
    }
    
    .unique-chat-messages {
      padding: 1rem;
      overflow-y: auto;
      max-height: calc(80vh - 140px);
    }
    
    .unique-message {
      margin-bottom: 1rem;
      max-width: 70%;
    }
    
    .unique-message.sent {
      margin-left: auto;
    }
    
    .unique-message-bubble {
      padding: 0.8rem;
      border-radius: 12px;
      background: var(--light);
      color:black;
    }
    
    .unique-message.sent .unique-message-bubble {
      background: var(--primary);
      color: white;
    }
    
    .unique-message-time {
      font-size: 0.8rem;
      color: var(--gray);
      margin-top: 0.3rem;
    }
    
    .unique-rating {
      display: inline-flex;
      margin-top: 0.5rem;
    }
    
    .unique-star {
      color: #ffd700;
      cursor: pointer;
    }
    
    .unique-chat-input {
      padding: 0.1rem;
      border-top: 1px solid #eee;
      display: flex;
      align-items: center;
      color:black;
    }
    
    .unique-chat-input input {
      flex: 1;
      padding: 0.8rem;
      border: 1px solid #eee;
      border-radius: 24px;
      margin-right: 1rem;
    }
    
    .unique-chat-input button {
      padding: 0.8rem 1.5rem;
      border: 2px solid transparent; /* Sin borde visible */
      border: none;
      background: var(--primary);
      color: white;
      border-radius: 24px;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .unique-chat-input button:hover {
      opacity: 0.9;
    }
    
    .unique-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      opacity: 0;
      transform: translateX(100%);
    }
    
    .unique-notification.animated {
      animation: unique-slideIn 0.5s forwards, unique-slideOut 0.5s forwards 3s;
    }
    
    @keyframes unique-slideIn {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes unique-slideOut {
      to {
        opacity: 0;
        transform: translateX(100%);
      }
    }
    
    .unique-blocked-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: var(--gray);
      flex-direction: column;
      gap: 1rem;
      z-index: 100;
    }
    
    .unique-notification-settings {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.2);
      display: none;
      color:black;
    }
    
    .unique-notification-settings.visible {
      display: block;
    }
    
    .unique-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .unique-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      color:black;
    }
    
    .unique-modal-buttons {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    
    .unique-modal-button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .unique-confirm-button {
      background: var(--primary);
      color: white;
    }
    
    .unique-cancel-button {
      background: var(--gray);
      color: white;
    }
    
    .unique-message-status {
      display: flex;
      gap: 2px;
      margin-top: 4px;
      font-size: 0.8rem;
    }
    
    .unique-check {
      color: #757575;
    }
    
    .unique-delivered .unique-check {
      color: #757575;
    }
    
    .unique-read .unique-check {
      color: #2196f3;
    }
    
    .unique-user-rating {
      display: none;
      margin-left: 10px;
      font-size: 0.9rem;
    }
    
    .unique-unblock-button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 24px;
      cursor: pointer;
      margin-top: 1rem;
    }
    
    .unique-notifications-icon {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1010;
    }
    
    .unique-notifications-icon button {
      background: white;
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .unique-notifications-icon i {
      font-size: 1.2rem;
      color: #666;
    }
    
    .unique-notifications-dropdown {
      position: fixed;
      top: 80px;
      right: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      display: none;
      z-index: 1010;
    }
    
    .unique-notifications-dropdown.show {
      display: block;
    }
    
    .unique-notification-item {
      padding: 1rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.3s;
      border-left: 4px solid transparent;
    }
    
    .unique-notification-item[style*="f8d7da"] {
      border-left-color: #dc3545;
    }
    
    .unique-notification-item[style*="d4edda"] {
      border-left-color: #28a745;
    }
    
    .unique-notification-item[style*="fff3cd"] {
      border-left-color: #ffc107;
    }
    
    .unique-notification-item:hover {
      filter: brightness(0.95);
    }
    
    .unique-notification-badge {
      background: red;
      color: white;
      border-radius: 50%;
      padding: 0.2rem 0.5rem;
      font-size: 0.8rem;
      position: absolute;
      top: -5px;
      right: -5px;
    }
    
    .unique-settings-rating {
      display: inline-flex !important;
      margin: 0.5rem 0;
    }
    
    .unique-settings-rating .unique-star {
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .unique-settings-rating .unique-star:hover {
      transform: scale(1.2);
    }
    @media screen and (max-width: 1024px) {
      .unique-chat-container {
        max-width: 800px;
        width: 90%;
      }
    }
    
    @media screen and (max-width: 768px) {
      .unique-chat-container {
        max-width: 600px;
        width: 95%;
      }
    }
    
    @media screen and (max-width: 480px) {
      .unique-chat-container {
        max-width: 100%;
        width: 100%;
        height: 100%;
        margin: 0;
        border-radius: 0; /* Quita bordes para ocupar todo el espacio en pantallas pequeñas */
      }
    }
    /* Ocultar lista de chats en pantallas pequeñas y ajustar el chat principal */
    @media screen and (max-width: 768px) {
      .unique-chat-main {
        width: 100%;
      }
    }
    button {
      background-color: #4CAF50; /* Verde suave */
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    button:hover {
      background-color: #45a049; /* Verde más oscuro en hover */
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    button:active {
      background-color: #388E3C; /* Verde más intenso al hacer clic */
      box-shadow: inset 0px 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    button:focus {
      outline: none; /* Elimina el borde predeterminado */
    }
    
    button[title] {
      display: flex;
      align-items: center;
      gap: 5px; /* Espacio entre el icono y el texto */
    }
    
    button span {
      font-weight: bold;
    }
    

    
</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TechVanguard{% endblock %}</title>
    <!-- Favicon -->
    <link rel="icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}"> <!-- Ruta a tu archivo CSS -->
    <link rel="stylesheet" href="{% static 'css/general.css' %}">
    <link rel="stylesheet" href="{% static 'css/in-styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/clientes.css' %}"> <!-- Ruta a tu archivo CSS -->
    <link rel="stylesheet" href="{% static 'css/servidor_sol_detalle.css' %}"> <!-- Ruta a tu archivo CSS -->
    <link rel="stylesheet" href="{% static 'css/profile.css' %}"> <!-- Ruta a tu archivo CSS -->
    <link rel="stylesheet" href="{% static 'css/historial.css' %}"> <!-- Ruta a tu archivo CSS -->
    <link rel="stylesheet" href="{% static 'css/profile_config.css' %}"> <!-- Ruta a tu archivo CSS -->
    <link rel="stylesheet" href="{% static 'css/messaging.css' %}">
    <link rel="stylesheet" href="{% static 'css/messaging-system.css' %}">
    <link rel="stylesheet" href="{% static 'css/ia.css' %}">

    <!-- External CSS libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@lucide-icons/react@0.6.2/dist/lucide.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>    




<header class="header">

    <div class="container">
      <a href="{% url 'home' %}" class="logo">
        <img src="{% static 'img/logo3.png' %}" alt="Logo de TechVanguard">
      </a>
        <button id="menu-toggle" class="block md:hidden text-black focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
        </button>
        
        <nav id="nav-menu" class="navigation">
            <a href="{% url 'home' %}" class="nav-link"><i class="fas fa-home"></i> Inicio</a>
            
            {% if user.is_authenticated %}
                {% if user.rol != 'Servidor' %}
                    <a href="{% url 'pagina_cliente' %}" class="nav-link"><i class="fas fa-users"></i> Clientes</a>
                {% endif %}
                
                {% if user.rol == 'Servidor' %}
                    <a href="{% url 'prestadores_dashboard' %}" class="nav-link"><i class="fas fa-cogs"></i> Prestadores</a>
                {% endif %}
                <!--a href="{% url 'profile' %}" class="nav-link"><i class="fas fa-user"></i> Perfil</a-->
                <!--a href="{% url 'historial' %}" class="nav-link"><i class="fas fa-history"></i> Historial</a-->
            {% endif %}
            
            <a href="#" class="nav-link"><i class="fas fa-info-circle"></i> Nosotros</a>
            <a href="{% url 'servicios' %}" class="nav-link"><i class="fas fa-briefcase"></i> Servicios</a>
           
            {% if user.is_authenticated %}
                <!--a href="{% url 'logout' %}" class="nav-link"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a-->
                <button id="theme-toggle" class="theme-toggle">
                  <!--i class="fas fa-sun"></i-->
              </button>
            
             
             
              
              <div class="unique-notifications-dropdown" id="uniqueNotificationsDropdown"></div>
              <div class="unique-chat-modal" id="uniqueChatModal">
                <div class="unique-chat-container" style="display: flex;">
                  <div class="unique-chat-list">
                    <div class="unique-chat-preview active">
                      <div class="unique-chat-preview-header">
                        <span class="unique-chat-preview-name">Ana Garc&#xed;a</span>
                        <span class="unique-chat-preview-time">10:30</span>
                      </div>
                      <div class="unique-chat-preview-last">&#xa1;Hola! &#xbf;C&#xf3;mo est&#xe1;s?</div>
                    </div>
                    
                    <div class="unique-chat-preview">
                      <div class="unique-chat-preview-header">
                        <span class="unique-chat-preview-name">Carlos L&#xf3;pez</span>
                        <span class="unique-chat-preview-time">09:15</span>
                      </div>
                      <div class="unique-chat-preview-last">Gracias por la informaci&#xf3;n</div>
                    </div>
                    
                    <div class="unique-chat-preview">
                      <div class="unique-chat-preview-header">
                        <span class="unique-chat-preview-name">Mar&#xed;a Rodr&#xed;guez</span>
                        <span class="unique-chat-preview-time">11:45</span>
                      </div>
                      <div class="unique-chat-preview-last">&#xbf;Quedamos para el caf&#xe9; ma&#xf1;ana?</div>
                    </div>
                    
                    <div class="unique-chat-preview">
                      <div class="unique-chat-preview-header">
                        <span class="unique-chat-preview-name">Juan P&#xe9;rez</span>
                        <span class="unique-chat-preview-time">11:20</span>
                      </div>
                      <div class="unique-chat-preview-last">Te envi&#xe9; los documentos por email</div>
                    </div>
                    
                    <div class="unique-chat-preview">
                      <div class="unique-chat-preview-header">
                        <span class="unique-chat-preview-name">Laura S&#xe1;nchez</span>
                        <span class="unique-chat-preview-time">10:55</span>
                      </div>
                      <div class="unique-chat-preview-last">&#xbf;Revisaste el proyecto?</div>
                    </div>
                  </div>
                  
                  <div class="unique-chat-main">
                    <div class="unique-chat-header">
                      <button onclick="uniqueCloseChat()" title="Cerrar chat">&#x2716;&#xfe0f;</button>
                      <button onclick="showChatList()" title="Volver a la lista">
                        &#x25c0; <span></span>
                      </button>
                      
                      <div class="unique-chat-header-info">
                        <h2>Ana Garc&#xed;a</h2>
                        <div style="display: flex; align-items: center;">
                          <span class="unique-status">En l&#xed;nea</span>
                          <span class="unique-user-rating"></span>
                        </div>
                      </div>
                      <div class="unique-chat-header-actions">
                        <button onclick="uniqueBlockUser()" title="Bloquear">&#x1f6ab;</button>
                        <button onclick="uniqueReportUser()" title="Reportar">&#x26a0;&#xfe0f;</button>
                        <button onclick="uniqueToggleNotificationSettings()" title="Configuraci&#xf3;n de notificaciones">&#x2699;&#xfe0f;</button>
                      </div>
                    </div>
                    
                    <div class="unique-chat-messages">
                      <div class="unique-message">
                        <div class="unique-message-bubble">&#xa1;Hola! &#xbf;C&#xf3;mo est&#xe1;s?</div>
                        <div class="unique-message-time">10:30</div>
                      </div>
                      
                      <div class="unique-message sent">
                        <div class="unique-message-bubble">&#xa1;Hola Ana! Todo bien, &#xbf;y t&#xfa;?</div>
                        <div class="unique-message-time">10:31</div>
                        <div class="unique-message-status">
                          <span class="unique-check">&#x2713;</span>
                          <span class="unique-check">&#x2713;</span>
                        </div>
                      </div>
                      
                      <div class="unique-message">
                        <div class="unique-message-bubble">Muy bien, gracias &#x1f60a;</div>
                        <div class="unique-message-time">10:32</div>
                      </div>
                    </div>
                    
                    <div class="unique-chat-input">
                      <input type="text" placeholder="Escribe un mensaje...">
                      <button>Enviar</button>
                    </div>
                  </div>
                  
                  <div class="unique-notification-settings" id="uniqueNotificationSettings">
                    <h3>Configuraci&#xf3;n</h3>
                    <div style="margin: 1rem 0;">
                      <label>
                        <input type="checkbox" id="uniqueEnableNotifications" checked>
                        Activar notificaciones
                      </label>
                    </div>
                    <div style="margin: 1rem 0;">
                      <label>
                        <input type="checkbox" id="uniqueAnimatedNotifications" checked>
                        Animaciones en notificaciones
                      </label>
                    </div>
                    <div style="margin: 1rem 0;">
                      <h4>Calificar Usuario</h4>
                      <div class="unique-rating unique-settings-rating">
                        <span class="unique-star" onclick="uniqueRateFromSettings(1)">&#x2b50;</span>
                        <span class="unique-star" onclick="uniqueRateFromSettings(2)">&#x2b50;</span>
                        <span class="unique-star" onclick="uniqueRateFromSettings(3)">&#x2b50;</span>
                        <span class="unique-star" onclick="uniqueRateFromSettings(4)">&#x2b50;</span>
                        <span class="unique-star" onclick="uniqueRateFromSettings(5)">&#x2b50;</span>
                      </div>
                    </div>
                    <button onclick="uniqueSaveNotificationSettings()" style="background: var(--primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                      Guardar
                    </button>
                  </div>
                  
                  <div class="unique-blocked-overlay" id="uniqueBlockedOverlay">
                    <div>Usuario bloqueado o reportado. No es posible enviar mensajes.</div>
                    <button class="unique-unblock-button" onclick="uniqueUnblockUser()">Desbloquear Usuario</button>
                  </div>
                  
                  <div class="unique-modal" id="uniqueBlockModal">
                    <div class="unique-modal-content">
                      <h3>&#xbf;Est&#xe1;s seguro de que deseas bloquear a este usuario?</h3>
                      <div class="unique-modal-buttons">
                        <button class="unique-modal-button unique-confirm-button" onclick="uniqueConfirmBlock()">S&#xed;</button>
                        <button class="unique-modal-button unique-cancel-button" onclick="uniqueCloseBlockModal()">No</button>
                      </div>
                    </div>
                  </div>
                  
                  <div class="unique-modal" id="uniqueReportModal">
                    <div class="unique-modal-content">
                      <h3>Reportar Usuario</h3>
                      <p>&#xbf;Est&#xe1;s seguro de que deseas reportar a este usuario?</p>
                      <textarea id="uniqueReportReason" placeholder="Indica el motivo del reporte" style="width: 100%; margin: 1rem 0; padding: 0.5rem; border-radius: 4px; border: 1px solid #eee;"></textarea>
                      <div class="unique-modal-buttons">
                        <button class="unique-modal-button unique-confirm-button" onclick="uniqueConfirmReport()">Reportar</button>
                        <button class="unique-modal-button unique-cancel-button" onclick="uniqueCloseReportModal()">Cancelar</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>












             





             <!-- Icono de Notificaciones -->
            <div class="icon-container">

                <div class="notification-icon nav-link">
                  <i class="fas fa-bell"></i>
                  <span class="badge">3</span>
                  <div class="dropdown" id="notifications-dropdown">
                      <div class="modal-header">
                          Notificaciones
                          <span class="dropdown-close">&#x2715;</span>
                      </div>
                      <div class="notification-item" data-id="1">
                          <strong>Nueva actualización</strong>
                          <p>Se ha lanzado una nueva versión de la app</p>
                      </div>
                      <div class="notification-item" data-id="2">
                          <strong>Recordatorio</strong>
                          <p>Tienes una reunión en 30 minutos</p>
                      </div>
                      <div class="notification-item" data-id="3">
                          <strong>¡Oferta especial!</strong>
                          <p>50% de descuento en servicios premium</p>
                      </div>
                      <div class="view-more">Ver más</div>
                  </div>
                </div>

                








                <div class="message-icon nav-link">
                  <button onclick="uniqueToggleNotifications()" title="Notificaciones"  >
                    <i class="fas fa-envelope"></i>
                    <span class="unique-notification-badge" id="uniqueNotificationBadge" style="display: none;">0</span>
                  </button>
                  
                </div>
            </div>

            {% else %} 
                <a href="{% url 'login' %}" class="nav-link"><i class="fas fa-sign-in-alt"></i> Iniciar sesión o Registrarse</a>
            {% endif %}
            
            {% if user.is_authenticated %}

            <div class="profile-wrapper">
                <button id="profile-btn" class="profile-button">
                  {% if user.foto_perfil %}
                  <img src="{{ user.foto_perfil.url }}" alt="Foto de perfil" class="profile-image">
              {% else %}
                  <img src="{% static 'img/placeholder.svg' %}" alt="Profile" class="profile-image">
                  {% endif %}
                
                </button>

                <div id="profile-dropdown" class="profile-dropdown">
                    <div class="profile-header">
                        <p class="username">{{ user.first_name }}</p>
                        <p class="email">{{ user.email }}</p>
                    </div>
                    <div class="profile-menu">
                      <a class="nav-link" href="{% url 'profile' %}">
                        <i class="fas fa-user"></i> My Profile
                    </a>
                        
                      <a class="nav-link" href="">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                    <a href="{% url 'historial' %}" class="nav-link">
                      <i class="fas fa-history"></i> Historial</a>

                        <div class="divider"></div>
                        <a class="nav-link" href="{% url 'logout' %}">
                          <i class="fas fa-sign-out-alt"></i> Logout
                      </a>
                </div>
                <div class="profile-footer">
                 
              </div>
            </div>
                {% endif %}
            </div>
        </nav>
        <div class="overlay" id="overlay"></div>

  <div class="notification-detail" id="notification-detail">
      <span class="close-detail" id="close-detail">&#x2715;</span>
      <h2 id="detail-title"></h2>
      <p id="detail-content"></p>
      <div id="detail-extra" style="margin-top: 1rem;"></div>
      <span style="cursor: pointer" id="close-chat" onclick="closeChat()">&#x2715;</span>

  </div>

  <div class="chat-container" id="chat-container" >
      
      <div class="chat-input">
          <input type="text" placeholder="Escribe un mensaje..." id="message-input">
          <button id="send-message">
            <i class="fas fa-arrow-right"></i> <!-- Aquí el ícono de la flecha -->
        </button>
          
        </div>
  </div>

<!-- Floating Chat Button -->
<button class="floating-chat-button" id="chatButton">
<svg viewBox="0 0 24 24">
  <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
</svg>
Asesor ia
</button>

<!-- Chat Window -->
<div class="chat-window" id="chatWindow">
<div class="chat-header">
  <h3 style="margin: 0">Asesor Virtual</h3>
  <button onclick="toggleChat()" style="background: none; border: none; color: white; cursor: pointer">
    ✕
  </button>
</div>

<div class="chat-messages" id="chatMessages">
  <div class="message bot-message">
    ¡Hola! Soy tu asistente virtual. ¿En qué puedo ayudarte hoy?
  </div>
</div>

<div class="chat-input">
  <input type="text" id="userInput" placeholder="Escribe tu mensaje..." onkeypress="handleKeyPress(event)">
  
  <button onclick="sendMessage()">
    <i class="fas fa-arrow-right"></i> <!-- Aquí el ícono de la flecha -->
</button>
</div>
</div>


</div>
</header>





<main class="unique-main">

 
</main>


</body>


{% block extra_js %}
<script>
// Place the JavaScript code here
// You may want to modify it to work with Django's CSRF protection and use Django's URL routing
let uniqueUserRating = 0;
let uniqueAutoReplyTimeout = null;
function uniqueAutoReply(messageText) {
  const autoResponses = ["¡Gracias por tu mensaje! Te responderé pronto.", "¡Hola! En este momento estoy ocupado(a), pero te contestaré lo antes posible.", "He recibido tu mensaje. Me pondré en contacto contigo pronto.", "¡Gracias por escribir! Te responderé en cuanto pueda."];
  clearTimeout(uniqueAutoReplyTimeout);
  uniqueAutoReplyTimeout = setTimeout(() => {
    const response = autoResponses[Math.floor(Math.random() * autoResponses.length)];
    const currentChatName = document.querySelector('.unique-chat-header-info h2').textContent;
    const messagesContainer = document.querySelector('.unique-chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'unique-message';
    messageDiv.innerHTML = `
      <div class="unique-message-bubble">${response}</div>
      <div class="unique-message-time">${new Date().toLocaleTimeString([], {
      hour: '2-digit',
      minute: '2-digit'
    })}</div>
    `;
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    uniqueAddNotification(`Nuevo mensaje de ${currentChatName}`, 'chat' + Date.now());
  }, 1000);
}
let uniqueIsUserBlocked = false;
let uniqueNotificationSettings = {
  enabled: true,
  animated: true
};
function uniqueShowNotification(message) {
  if (!uniqueNotificationSettings.enabled) return;
  const notification = document.createElement('div');
  notification.className = 'unique-notification';
  if (uniqueNotificationSettings.animated) {
    notification.classList.add('animated');
  }
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => {
    notification.remove();
  }, 4000);
}
function uniqueRateFromSettings(stars) {
  uniqueUserRating = stars;
  uniqueUpdateUserRating();
  uniqueAddNotification(`Has calificado al usuario con ${stars} estrellas`, null, 'rating');
}
function uniqueUpdateUserRating() {
  const ratingDisplay = document.querySelector('.unique-user-rating');
  if (uniqueUserRating > 0) {
    ratingDisplay.innerHTML = '⭐'.repeat(uniqueUserRating);
    ratingDisplay.style.display = 'block';
  }
}
function uniqueBlockUser() {
  document.getElementById('uniqueBlockModal').style.display = 'flex';
}
function uniqueCloseBlockModal() {
  document.getElementById('uniqueBlockModal').style.display = 'none';
}
function uniqueConfirmBlock() {
  uniqueIsUserBlocked = true;
  document.getElementById('uniqueBlockedOverlay').style.display = 'flex';
  uniqueAddNotification('Has bloqueado al usuario', null, 'block');
  uniqueCloseBlockModal();
  const unblockBtn = document.createElement('button');
  unblockBtn.textContent = 'Desbloquear';
  unblockBtn.onclick = uniqueUnblockUser;
  unblockBtn.className = 'unique-modal-button unique-confirm-button';
  document.getElementById('uniqueBlockedOverlay').appendChild(unblockBtn);
}
function uniqueUnblockUser() {
  uniqueIsUserBlocked = false;
  document.getElementById('uniqueBlockedOverlay').style.display = 'none';
  uniqueAddNotification('Has desbloqueado al usuario', null, 'unblock');
}
let uniqueMessageStatuses = ['sent', 'delivered', 'read'];
let uniqueCurrentStatusIndex = 0;
function uniqueUpdateMessageStatus(messageElement) {
  const statusDiv = messageElement.querySelector('.unique-message-status');
  const status = uniqueMessageStatuses[uniqueCurrentStatusIndex];
  statusDiv.innerHTML = '';
  if (status === 'sent') {
    statusDiv.innerHTML = '<span class="unique-check">✓</span>';
  } else if (status === 'delivered') {
    statusDiv.innerHTML = '<span class="unique-check">✓</span><span class="unique-check">✓</span>';
  } else if (status === 'read') {
    statusDiv.innerHTML = '<span class="unique-check">✓</span><span class="unique-check">✓</span>';
    statusDiv.classList.add('unique-read');
  }
  uniqueCurrentStatusIndex = (uniqueCurrentStatusIndex + 1) % uniqueMessageStatuses.length;
}
function uniqueSendMessage() {
  if (uniqueIsUserBlocked) {
    uniqueShowNotification('No puedes enviar mensajes a este usuario');
    return;
  }
  const text = uniqueInput.value.trim();
  if (text) {
    const messagesContainer = document.querySelector('.unique-chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'unique-message sent';
    messageDiv.innerHTML = `
      <div class="unique-message-bubble">${text}</div>
      <div class="unique-message-time">${new Date().toLocaleTimeString([], {
      hour: '2-digit',
      minute: '2-digit'
    })}</div>
      <div class="unique-message-status">
        <span class="unique-check">✓</span>
      </div>
    `;
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    uniqueInput.value = '';
    setTimeout(() => uniqueUpdateMessageStatus(messageDiv), 1000);
    setTimeout(() => uniqueUpdateMessageStatus(messageDiv), 2000);
    uniqueShowNotification('Mensaje enviado');
    uniqueAutoReply(text);
  }
}
function uniqueReportUser() {
  document.getElementById('uniqueReportModal').style.display = 'flex';
}
function uniqueCloseReportModal() {
  document.getElementById('uniqueReportModal').style.display = 'none';
}
function uniqueConfirmReport() {
  const reason = document.getElementById('uniqueReportReason').value.trim();
  if (reason) {
    uniqueIsUserBlocked = true;
    document.getElementById('uniqueBlockedOverlay').style.display = 'flex';
    uniqueAddNotification('Has reportado al usuario: ' + reason, null, 'report');
    uniqueCloseReportModal();
    document.getElementById('uniqueReportReason').value = '';
  } else {
    uniqueShowNotification('Por favor, indica un motivo para el reporte');
  }
}
function uniqueToggleNotificationSettings() {
  const settings = document.getElementById('uniqueNotificationSettings');
  settings.classList.toggle('visible');
}
function uniqueSaveNotificationSettings() {
  uniqueNotificationSettings.enabled = document.getElementById('uniqueEnableNotifications').checked;
  uniqueNotificationSettings.animated = document.getElementById('uniqueAnimatedNotifications').checked;
  document.getElementById('uniqueNotificationSettings').classList.remove('visible');
  uniqueShowNotification('Configuración guardada');
}
const uniqueInput = document.querySelector('.unique-chat-input input');
const uniqueSendButton = document.querySelector('.unique-chat-input button');
uniqueSendButton.addEventListener('click', uniqueSendMessage);
uniqueInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    uniqueSendMessage();
  }
});
let uniqueNotifications = [];
let uniqueUnreadCount = 0;
function uniqueAddNotification(message, chatId, type = 'message') {
  uniqueNotifications.unshift({
    message,
    chatId,
    timestamp: new Date(),
    type
  });
  uniqueUnreadCount++;
  uniqueUpdateNotificationBadge();
  uniqueUpdateNotificationsDropdown();
}
function uniqueUpdateNotificationBadge() {
  const badge = document.getElementById('uniqueNotificationBadge');
  if (uniqueUnreadCount > 0) {
    badge.style.display = 'block';
    badge.textContent = uniqueUnreadCount;
  } else {
    badge.style.display = 'none';
  }
}
function uniqueUpdateNotificationsDropdown() {
  const dropdown = document.getElementById('uniqueNotificationsDropdown');
  if (uniqueNotifications.length === 0) {
    dropdown.innerHTML = `
      <div class="unique-notification-item">
        No hay notificaciones nuevas
      </div>
    `;
    return;
  }
  dropdown.innerHTML = uniqueNotifications.map((notif, index) => {
    let icon = '💬';
    let backgroundColor = '#fff';
    switch (notif.type) {
      case 'rating':
        icon = '⭐';
        backgroundColor = '#fff3cd';
        break;
      case 'block':
        icon = '🚫';
        backgroundColor = '#f8d7da';
        break;
      case 'unblock':
        icon = '🔓';
        backgroundColor = '#d4edda';
        break;
      case 'report':
        icon = '⚠️';
        backgroundColor = '#fff3cd';
        break;
    }
    return `
      <div class="unique-notification-item" 
           onclick="uniqueHandleNotificationClick('${notif.chatId}')"
           style="background-color: ${backgroundColor}">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span>${icon}</span>
          <div>
            ${notif.message}
            <div class="unique-chat-preview-time">
              ${notif.timestamp.toLocaleTimeString([], {
      hour: '2-digit',
      minute: '2-digit'
    })}
            </div>
          </div>
        </div>
      </div>
    `;
  }).join('');
}
function uniqueHandleNotificationClick(chatId) {
  const chatModal = document.getElementById('uniqueChatModal');
  const chatContainer = document.querySelector('.unique-chat-container');
  chatModal.style.display = 'flex';
  chatContainer.style.display = 'flex';
  uniqueGoToChat(chatId);
  const dropdown = document.getElementById('uniqueNotificationsDropdown');
  dropdown.classList.remove('show');
}
function uniqueGoToChat(chatId) {
  const chatModal = document.getElementById('uniqueChatModal');
  chatModal.style.display = 'flex';
  document.getElementById('uniqueNotificationsDropdown').classList.remove('show');
  uniqueUnreadCount = 0;
  uniqueUpdateNotificationBadge();
  const messagesContainer = document.querySelector('.unique-chat-messages');
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}
function uniqueCloseChat() {
  const chatModal = document.getElementById('uniqueChatModal');
  const chatContainer = document.querySelector('.unique-chat-container');
  chatModal.style.display = 'none';
  chatContainer.style.display = 'none';
  uniqueShowNotification('Chat cerrado');
}
document.addEventListener('DOMContentLoaded', () => {
  uniqueInitializeChatPreviews();
});
document.addEventListener('click', e => {
  const chatModal = document.getElementById('uniqueChatModal');
  const chatContainer = document.querySelector('.unique-chat-container');
  const notificationsButton = document.querySelector('.unique-notifications-icon button');
  const dropdown = document.getElementById('uniqueNotificationsDropdown');
  if (chatModal.style.display === 'flex' && !chatContainer.contains(e.target) && !notificationsButton.contains(e.target) && !dropdown.contains(e.target)) {
    uniqueCloseChat();
  }
});
function uniqueInitializeChatPreviews() {
  const chatPreviews = document.querySelectorAll('.unique-chat-preview');
  chatPreviews.forEach(preview => {
    preview.addEventListener('click', () => {
      chatPreviews.forEach(p => p.classList.remove('active'));
      preview.classList.add('active');
      const userName = preview.querySelector('.unique-chat-preview-name').textContent;
      document.querySelector('.unique-chat-header-info h2').textContent = userName;
      const messagesContainer = document.querySelector('.unique-chat-messages');
      messagesContainer.innerHTML = '';
      const lastMessage = preview.querySelector('.unique-chat-preview-last').textContent;
      const time = preview.querySelector('.unique-chat-preview-time').textContent;
      const messageDiv = document.createElement('div');
      messageDiv.className = 'unique-message';
      messageDiv.innerHTML = `
        <div class="unique-message-bubble">${lastMessage}</div>
        <div class="unique-message-time">${time}</div>
      `;
      messagesContainer.appendChild(messageDiv);
      uniqueUserRating = 0;
      document.querySelector('.unique-user-rating').style.display = 'none';
      uniqueIsUserBlocked = false;
      document.getElementById('uniqueBlockedOverlay').style.display = 'none';
    });
  });
}
function uniqueToggleNotifications() {
  const dropdown = document.getElementById('uniqueNotificationsDropdown');
  const chatModal = document.getElementById('uniqueChatModal');
  const chatContainer = document.querySelector('.unique-chat-container');
  dropdown.classList.toggle('show');
  if (uniqueNotifications.length === 0) {
    chatModal.style.display = 'flex';
    chatContainer.style.display = 'flex';
    dropdown.classList.remove('show');
  }
}

// Detecta cuando se hace clic en un chat de la lista
document.querySelectorAll('.unique-chat-preview').forEach(chat => {
  chat.addEventListener('click', () => {
    // Ocultar la lista de chats
    document.querySelector('.unique-chat-list').style.display = 'none';
    
    // Mostrar solo el chat principal
    document.querySelector('.unique-chat-main').style.width = '100%';
  });
});

// Botón para volver a la lista de chats
function showChatList() {
  document.querySelector('.unique-chat-list').style.display = 'block';
  document.querySelector('.unique-chat-main').style.width = ''; // Restablece el ancho original
}

</script>

{% endblock %}
